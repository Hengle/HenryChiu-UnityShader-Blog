# 基于图像后处理的描边
话不多说，先看效果图。
![img-01](http://www.cherryfrog.net/images/blogs/outline-postpro-01.png)

## 基本原理
在渲染前，将待描边的物体渲染到临时缓存纹理中；通过数字图像处理的方法，完成描边；渲染后，再将缓存纹理和渲染结果（帧缓存）相混合。具体过程下面会说。

## 数字图像处理基础
这里我把需要本文用到的数字图像处理方面的基础知识写出来。
### 卷积（Convolution）
卷积操作广泛用于信号处理领域。它的严格定义比较复杂，这里简单说一下图像处理中的卷积的意思。卷积是这样一个操作：对于图像中的每一个像素，依次对它使用一个模板（卷积核）来进行计算，得到这个像素的新值。模糊、浮雕、边缘检测和锐化等常见效果都是由卷积操作实现的。
### 卷积核（Convolution Kernel）
卷积核本质上一个矩阵，通常是方形矩阵。有时也称作“算子”。这个矩阵的中心点对应的是当前要处理的像素点，矩阵上的其它点则对应当前像素点附近对应位置上的像素点。矩阵上的值表示对应像素点在计算过程中的权重。翻转核之后，按照权重值将矩阵对应的所有像素点的颜色值进行加权求和，得到该像素点的新颜色值。
卷积核直接决定了卷积的最终效果。例如，均值模糊卷积核：
![img-kernel-01](http://www.cherryfrog.net/images/blogs/outline-kernel-001.png)

很好理解，这个卷积核的作用就是把像素和它周围的像素的颜色值进行平均。
还有一种常见的模糊，高斯模糊。它的卷积核是二维正态分布函数的离散形式。下面这个卷积核是本文将采用的高斯模糊的近似核。
![img-kernel-02](http://www.cherryfrog.net/images/blogs/outline-kernel-002.png)

## 基于高斯模糊的描边算法
下图表示了具体的描边过程。PreOutline过程在渲染前完成。这个过程先将要描边的物体渲染为纯色，输出到缓存纹理(preTexture1)中。然后通过对渲染缓存纹理进行高斯模糊，得到模糊后的缓存纹理（preTexture2）。用preTexture1减去preTexture2，即可得到描边纹理。在渲染完成后，将描边纹理叠加到渲染结果上即可。
![img02](http://www.cherryfrog.net/images/blogs/outline-postpro-02.png)

## 实践
